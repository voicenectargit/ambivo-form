<!-- Progress bar -->
<div *ngIf="field.fieldGroup[currentStep] as step">
  <div class="ambivo-form--step-header">
    <div class="ambivo-form--step-title">
      {{ step.templateOptions.label }}
      <small>({{ currentStep + 1 }} of {{ length }} )</small>
    </div>
    <div
      class="ambivo-form--step-description"
      *ngIf="step.templateOptions.description as description"
    >
      {{ description }}
    </div>
  </div>
  <div class="ambivo-form--progress">
    <span [style.width]="((currentStep + 1) / length) * 100 + '%'"></span>
  </div>
</div>

<!-- Steps -->
<ng-container
  *ngFor="let step of field.fieldGroup; let index = index; let last = last"
>
  <div class="ambivo-form--step" *ngIf="index === currentStep">
    <!-- Step fields -->
    <formly-field [field]="step"></formly-field>

    <!-- Actions -->
    <div class="ambivo-form--actions">
      <button
        type="button"
        class="ambivo-form--button"
        *ngIf="index !== 0"
        (click)="prev()"
      >
        Back
      </button>

      <button
        type="button"
        class="ambivo-form--button"
        *ngIf="!last"
        (click)="next()"
        [disabled]="!isValid(step)"
      >
        Next
      </button>

      <ng-container *ngIf="widget$ | async as widget">
        <button
          *ngIf="last"
          class="ambivo-form--button"
          [disabled]="!form.valid"
          type="submit"
          (click)="submit(widget)"
        >
          {{ widget.body?.submit }}
        </button>
      </ng-container>
    </div>
  </div>
</ng-container>
